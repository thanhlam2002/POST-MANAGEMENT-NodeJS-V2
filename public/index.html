<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Post Management App</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f5f5f5; }
        header { background: #343a40; color: white; padding: 15px; text-align: center; position: sticky; top: 0; display: flex; justify-content: space-between; align-items: center; }
        header button { background: #28a745; border: none; color: white; padding: 10px 15px; border-radius: 5px; cursor: pointer; }
        .container { width: 400px; margin: 50px auto; background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        .hidden { display: none; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; padding: 20px; }
        .post { background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 0 5px rgba(0,0,0,0.1); }
        .post img { max-width: 100%; border-radius: 5px; }
        .post-actions button { margin-right: 5px; }
    </style>
</head>
<body>
    <header>
        <h2>Post Management</h2>
        <div>
            <button id="loginToggle">Login</button>
            <button id="logoutBtn" class="hidden">Logout</button>
        </div>
    </header>

    <div class="container hidden" id="authContainer">
        <h1 id="authTitle">Login</h1>
        <form id="authForm">
            <input type="text" id="authUsername" placeholder="Username" required>
            <input type="password" id="authPassword" placeholder="Password" required>
            <button type="submit">Submit</button>
        </form>
        <p><a href="#" id="toggleAuthMode">Don't have an account? Register</a></p>
    </div>

    <div class="container hidden" id="postFormContainer">
        <h1>Create Post</h1>
        <form id="postForm">
            <input type="text" id="title" placeholder="Title">
            <input type="text" id="content" placeholder="Content">
            <input type="text" id="category" placeholder="Category">
            <input type="file" id="thumbnail">
            <button type="submit">Create Post</button>
        </form>
    </div>

    <div class="grid" id="postList"></div>

    <script>
        let token = "";
        let currentUserId = "";
        let isLoginMode = true;

        document.getElementById('loginToggle').addEventListener('click', () => {
            document.getElementById('authContainer').classList.toggle('hidden');
        });

        document.getElementById('toggleAuthMode').addEventListener('click', (e) => {
            e.preventDefault();
            isLoginMode = !isLoginMode;
            document.getElementById('authTitle').textContent = isLoginMode ? 'Login' : 'Register';
            document.getElementById('toggleAuthMode').textContent = isLoginMode ? "Don't have an account? Register" : "Already have an account? Login";
        });

        document.getElementById('authForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('authUsername').value;
            const password = document.getElementById('authPassword').value;
            const endpoint = isLoginMode ? '/api/login' : '/api/register';

            const res = await fetch(endpoint, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password })
            });

            const data = await res.json();

            if (res.ok) {
                if (isLoginMode) {
                    token = data.token;
                    currentUserId = parseJwt(token).id;
                    document.getElementById('authContainer').classList.add('hidden');
                    document.getElementById('postFormContainer').classList.remove('hidden');
                    document.getElementById('loginToggle').classList.add('hidden');
                    document.getElementById('logoutBtn').classList.remove('hidden');
                    loadPosts();
                } else {
                    alert(data.message);
                }
            } else {
                alert(data.message);
            }
        });

        document.getElementById('logoutBtn').addEventListener('click', () => {
            token = "";
            currentUserId = "";
            document.getElementById('postFormContainer').classList.add('hidden');
            document.getElementById('loginToggle').classList.remove('hidden');
            document.getElementById('logoutBtn').classList.add('hidden');
            loadPosts();
        });

        document.getElementById('postForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData();
            formData.append('title', document.getElementById('title').value);
            formData.append('content', document.getElementById('content').value);
            formData.append('category', document.getElementById('category').value);
            formData.append('thumbnail', document.getElementById('thumbnail').files[0]);

            const res = await fetch('/api/posts', {
                method: 'POST',
                headers: { 'Authorization': `Bearer ${token}` },
                body: formData
            });

            alert(await res.text());
            loadPosts();
        });

        async function loadPosts() {
            const res = await fetch('/api/posts');
            const posts = await res.json();
            const postList = document.getElementById('postList');
            postList.innerHTML = '';
            posts.forEach(post => {
                const div = document.createElement('div');
                div.className = 'post';
                div.innerHTML = `
                    <h3>${post.title}</h3>
                    <p>${post.content}</p>
                    <img src="${post.thumbnail}" alt="Thumbnail">
                    ${post.author && post.author._id === currentUserId ? `
                        <div class="post-actions">
                            <button onclick="editPost('${post._id}')">Edit</button>
                            <button onclick="deletePost('${post._id}')">Delete</button>
                        </div>` : ''}
                `;
                postList.appendChild(div);
            });
        }

        async function editPost(postId) {
            const newTitle = prompt('New title:');
            const newContent = prompt('New content:');
            const res = await fetch(`/api/posts/${postId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({ title: newTitle, content: newContent })
            });
            alert(await res.text());
            loadPosts();
        }

        async function deletePost(postId) {
            const res = await fetch(`/api/posts/${postId}`, {
                method: 'DELETE',
                headers: { 'Authorization': `Bearer ${token}` }
            });
            alert(await res.text());
            loadPosts();
        }

        function parseJwt(token) {
            const base64Url = token.split('.')[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));
            return JSON.parse(jsonPayload);
        }

        loadPosts();
    </script>
</body>
</html>





